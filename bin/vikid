#!/usr/bin/env python3

"""
Viki daemon
~~~~~~~~~~~

The automation framework

Usage:
    jobs
    job/<jobName>
    job/<jobName>/run

Maintainer:
    John Shanahan <shanahan.jrs@gmail.com>

License:
    Apache 2.0
    http://www.apache.org/licenses/LICENSE-2.0

"""


# --- Imports

try:
    from flask import Flask, request, jsonify, render_template
    import os
    import logging
    from logging.config import dictConfig

    from src.job.job import Job
    from src.application.app import App
    from src.blueprints import api_blueprint
except ImportError as error:
    exit('ImportError: ' + str(error))


# --- Setup

debug = True


# --- Classes / globals


app = Flask(__name__)
viki_app = App()
job = Job()
version = viki_app.version

# TODO pull all of this from App
home_directory = viki_app.home
dictConfig(viki_app.logging_config)
logger = logging.getLogger()


# Start logging
logger.info('===== Vikid =====')

# --- UI Route

@app.route("/")
def root():
    """ Home """

    ret = {"name": "viki", "version": version}

    return render_template('home.html', data=ret)


# --- Api Route

app.register_blueprint(api_blueprint.api_blueprint)


# --- Other/custom Routes

# Custom route blueprints go here.
# from src.blueprints import <YOURBLUEPRINT>
# app.register_blueprint(<YOURBLUEPRINT>.<BLUEPRINTNAME>)


# --- Start

app.run(port=9898)

